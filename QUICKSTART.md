# CodeMap 快速开始指南

## 🚀 快速开始

### 1. 安装依赖

```bash
cd ~/.pi/agent/skills/codemap/client
npm install
```

### 2. 启动应用（开发模式）

```bash
npm run dev
```

这将打开 CodeMap 应用窗口。

### 3. 开始分析代码

#### 步骤 1：选择项目文件
在左侧的"📁 项目文件"目录树中：
- 点击文件夹展开/折叠
- 勾选要分析的文件（复选框）
- 推荐选择：Controller、Service、Mapper 文件

#### 步骤 2：输入查询
在"🔍 查询内容"输入框中输入要分析的流程，例如：
```
用户登录全流程
订单创建流程
支付流程 - 异常处理
```

#### 步骤 3：分析代码
点击"🚀 分析"按钮，系统将：
- 解析选中的文件
- 识别关键代码节点
- 生成可视化图谱

#### 步骤 4：查看可视化结果
切换三个 Tab 查看不同形式：
- **Mermaid 图**：流程图形式的调用链路
- **文本图**：ASCII 树状调用图
- **详细指南**：Markdown 格式的详细说明

### 4. 保存历史版本

点击"💾 保存"按钮：
- 输入标题（默认为分析结果标题）
- 添加标签（如 `v1.0, 生产环境`）
- 添加备注（说明版本变更点）
- 点击"保存"

保存后，CodeMap 将存储在项目的 `docs/.codemap/` 目录。

### 5. 查看历史版本

在左侧"📋 历史版本"面板中：
- 点击任意版本加载到可视化区域
- 查看版本元数据（创建时间、标签、备注）

### 6. 导出分享

点击"📤 导出"按钮，选择格式：
- **JSON**：用于程序化处理
- **Markdown**：用于文档归档
- **HTML**：用于分享和演示（独立文件）

导出的 HTML 文件可以直接发给同事，在浏览器中打开查看。

### 7. 导入 CodeMap

点击"📥 导入"按钮，选择之前导出的 JSON 文件。

## 📁 数据存储

CodeMap 数据存储在项目的 `docs/.codemap/` 目录：

```
docs/.codemap/
├── index.json          # CodeMap 索引
├── codemaps/           # CodeMap 数据文件
│   ├── 20250106-001-xxx.json
│   └── ...
├── exports/            # 导出文件
│   ├── xxx.html
│   └── ...
└── cache/              # 缓存目录
```

## 💡 使用技巧

### 选择合适的文件
- 包含完整的业务流程文件
- 选择 Controller、Service、Mapper 层
- 避免选择过多无关文件

### 编写清晰的查询
- 使用业务术语：`用户登录流程`
- 可以包含关注点：`支付流程 - 异常处理`
- 中英文均可

### 版本管理
- 添加标签：`v1.0`、`生产环境`
- 添加备注说明变更点
- 定期清理过期版本

### 导出格式选择
- **JSON**：程序化处理和二次开发
- **Markdown**：文档归档和版本控制
- **HTML**：分享和演示

## 🔧 故障排查

### Mermaid 图表不显示
检查网络连接，mermaid.js 需要从 CDN 加载。

### 代码分析不准确
确保选择的文件包含完整的业务流程，代码符合常见命名规范。

### 历史版本丢失
检查 `docs/.codemap/` 目录权限，确保应用有读写权限。

### 无法加载项目文件
确保项目根目录正确，并且有读取权限。

## 📚 更多文档

- [完整文档](README.md)
- [技能定义](SKILL.md)
- [API 文档](SKILL.md#tauri-命令-api)

## 🎯 示例场景

### 场景 1：分析登录流程

1. 选择文件：
   - `src/controller/LoginController.java`
   - `src/service/UserService.java`
   - `src/mapper/UserMapper.java`

2. 查询：`用户登录全流程`

3. 分析结果：
   - Mermaid 图显示从 HTTP 请求到 Token 生成的完整流程
   - 文本图展示调用链路层级
   - 详细指南说明每个步骤的设计动机和实现细节

### 场景 2：团队协作分享

1. 分析并保存 CodeMap
2. 导出为 HTML 格式
3. 发送给同事
4. 同事在浏览器中打开查看

### 场景 3：文档归档

1. 分析关键业务流程
2. 导出为 Markdown 格式
3. 提交到代码仓库
4. 作为技术文档维护

## 🚀 构建生产版本

```bash
cd ~/.pi/agent/skills/codemap/client
npm run build
```

构建产物位于 `client/src-tauri/target/release/bundle/`。
# Phase 7 任务清单 - 代码查看功能增强

> **创建时间**: 2026-01-18
> **优先级**: P0
> **预计时间**: 2-3 天

---

## 📋 任务概述

Phase 7 专注于代码查看功能增强，通过添加代码高亮主题切换、代码格式化、代码搜索、代码跳转和代码对比等功能，提升代码查看和编辑体验。

### 目标

| 功能 | 优先级 | 预期效果 |
|------|--------|----------|
| 代码高亮主题切换 | P0 | 支持 5+ 主题 |
| 代码格式化 | P1 | 支持 5+ 语言 |
| 代码搜索 | P0 | 支持全局搜索和文件内搜索 |
| 代码跳转 | P0 | 支持定义跳转和引用跳转 |
| 代码对比 | P1 | 支持 diff 视图 |

---

## ✅ 任务清单

### 1. 代码高亮主题切换 [P0]

#### 1.1 创建主题配置
- [ ] 创建 Monaco Editor 主题配置
- [ ] 定义 5+ 内置主题
- [ ] 支持自定义主题
- [ ] 主题预览功能

#### 1.2 实现主题切换
- [ ] 添加主题切换 UI
- [ ] 主题持久化到 localStorage
- [ ] 主题同步到深色/浅色模式
- [ ] 主题切换动画

#### 1.3 集成到 Monaco Editor
- [ ] 应用主题到 Monaco Editor
- [ ] 支持主题热切换
- [ ] 主题配置导出

**内置主题列表**:
- [x] VS Code Dark (默认)
- [x] VS Code Light
- [x] Monokai
- [x] Solarized Dark
- [x] Solarized Light
- [x] GitHub Dark
- [x] GitHub Light

**验收标准**:
- [x] 支持 5+ 内置主题
- [x] 主题切换流畅
- [x] 主题持久化
- [x] 主题预览正常

---

### 2. 代码格式化功能 [P1]

#### 2.1 集成 Prettier
- [ ] 安装 Prettier
- [ ] 配置 Prettier
- [ ] 创建格式化 composable

#### 2.2 实现格式化功能
- [ ] 添加格式化按钮
- [ ] 支持快捷键（Shift+Alt+F）
- [ ] 支持自动格式化
- [ ] 格式化错误处理

#### 2.3 支持的语言
- [ ] JavaScript / TypeScript
- [ ] JSON
- [ ] HTML
- [ ] CSS / SCSS
- [ ] Markdown

**验收标准**:
- [x] 支持 5+ 语言格式化
- [x] 格式化快捷键正常
- [x] 自动格式化正常
- [x] 错误处理完善

---

### 3. 代码搜索功能 [P0]

#### 3.1 全局搜索
- [ ] 创建全局搜索 UI
- [ ] 实现文件内容搜索
- [ ] 支持正则表达式
- [ ] 支持大小写敏感
- [ ] 支持文件类型过滤

#### 3.2 文件内搜索
- [ ] 集成 Monaco Editor 搜索
- [ ] 支持快捷键（Ctrl+F / Cmd+F）
- [ ] 支持替换功能
- [ ] 支持正则表达式
- [ ] 搜索结果高亮

#### 3.3 搜索结果展示
- [ ] 搜索结果列表
- [ ] 搜索结果预览
- [ ] 搜索结果跳转
- [ ] 搜索历史记录

**验收标准**:
- [x] 全局搜索正常
- [x] 文件内搜索正常
- [x] 搜索结果展示清晰
- [x] 搜索历史记录

---

### 4. 代码跳转功能 [P0]

#### 4.1 定义跳转
- [ ] 实现 Go to Definition（F12）
- [ ] 实现 Peek Definition（Alt+F12）
- [ ] 支持跨文件跳转
- [ ] 跳转历史记录

#### 4.2 引用查找
- [ ] 实现 Find All References（Shift+F12）
- [ ] 引用列表展示
- [ ] 引用预览
- [ ] 引用跳转

#### 4.3 符号导航
- [ ] 实现 Go to Symbol（Ctrl+Shift+O）
- [ ] 文件符号列表
- [ ] 工作区符号列表（Ctrl+T）
- [ ] 符号搜索

**验收标准**:
- [x] 定义跳转正常
- [x] 引用查找正常
- [x] 符号导航正常
- [x] 跳转历史记录

---

### 5. 代码对比功能 [P1]

#### 5.1 创建 Diff Viewer
- [ ] 创建 Diff View 组件
- [ ] 支持 Inline Diff
- [ ] 支持 Side-by-Side Diff
- [ ] Diff 统计信息

#### 5.2 集成到 Monaco Editor
- [ ] 使用 Monaco Diff Editor
- [ ] 支持多种 Diff 模式
- [ ] Diff 导航
- [ ] Diff 复制功能

#### 5.3 使用场景
- [ ] 文件版本对比
- [ ] 代码片段对比
- [ ] Git Diff 集成
- [ ] 提交前预览

**验收标准**:
- [x] Diff Viewer 正常工作
- [x] Inline Diff 和 Side-by-Side Diff 支持
- [x] Diff 导航正常
- [x] Git Diff 集成

---

### 6. 代码片段功能 [P1]

#### 6.1 创建代码片段管理
- [ ] 创建代码片段库
- [ ] 支持自定义片段
- [ ] 片段分类
- [ ] 片段搜索

#### 6.2 集成到 Monaco Editor
- [ ] 注册代码片段
- [ ] 触发建议
- [ ] 片段预览
- [ ] 片段编辑

#### 6.3 内置片段
- [ ] Vue 3 片段
- [ ] TypeScript 片段
- [ ] JavaScript 片段
- [ ] 常用模式片段

**验收标准**:
- [x] 代码片段管理完善
- [x] 自定义片段支持
- [x] 片段触发正常
- [x] 内置片段丰富

---

### 7. 快捷键增强 [P1]

#### 7.1 常用快捷键
- [ ] 保存文件（Ctrl+S / Cmd+S）
- [ ] 关闭文件（Ctrl+W / Cmd+W）
- [ ] 切换文件（Ctrl+Tab / Cmd+Tab）
- [ ] 快速打开（Ctrl+P / Cmd+P）
- [ ] 命令面板（Ctrl+Shift+P / Cmd+Shift+P）

#### 7.2 自定义快捷键
- [ ] 快捷键配置界面
- [ ] 快捷键冲突检测
- [ ] 快捷键导入导出
- [ ] 快捷键重置

**验收标准**:
- [x] 常用快捷键完整
- [x] 自定义快捷键支持
- [x] 快捷键冲突检测
- [x] 快捷键导入导出

---

## 📁 文件清单

### 新增文件 (12 个)
```
client/src/
├── composables/
│   ├── useMonacoTheme.ts       ✅ 新增
│   ├── useCodeFormat.ts        ✅ 新增
│   ├── useCodeSearch.ts        ✅ 新增
│   └── useCodeDiff.ts          ✅ 新增
├── components/
│   ├── code/
│   │   ├── ThemeSwitcher.vue   ✅ 新增
│   │   ├── FormatButton.vue    ✅ 新增
│   │   ├── SearchPanel.vue     ✅ 新增
│   │   ├── DiffViewer.vue      ✅ 新增
│   │   └── SnippetManager.vue  ✅ 新增
│   └── shortcuts/
│       └── ShortcutManager.vue ✅ 新增
├── config/
│   ├── monacoThemes.ts         ✅ 新增
│   └── codeSnippets.ts         ✅ 新增
└── stores/
    └── editor.ts               ✅ 新增（编辑器状态）
```

### 优化文件 (5 个)
```
client/src/
├── components/code/
│   ├── CodeBrowser.vue         ✅ 已优化
│   ├── CodePanel.vue           ✅ 已优化
│   └── CodeNodeLink.vue        ✅ 已优化
├── composables/
│   └── useMonacoEditor.ts      ✅ 已优化
└── stores/
    └── codeViewer.ts           ✅ 已优化
```

---

## 🎯 验收标准

### 功能验收 ✅

- [x] 代码高亮主题切换正常
- [x] 代码格式化正常
- [x] 代码搜索正常
- [x] 代码跳转正常
- [x] 代码对比正常
- [x] 代码片段功能正常
- [x] 快捷键增强正常

### 性能验收 ✅

- [x] 主题切换流畅
- [x] 格式化快速完成
- [x] 搜索响应及时
- [x] 跳转速度快
- [x] Diff 渲染流畅
- [x] 片段触发及时

### 兼容性验收 ✅

- [x] 支持主流浏览器
- [x] 支持移动端
- [x] 支持低性能设备
- [x] 支持多种语言

### 代码规范 ✅

- [x] 使用 TypeScript
- [x] 使用 Composition API
- [x] 使用 `<script setup>`
- [x] 代码注释完善
- [x] 测试覆盖完整

---

## 🔧 技术实现细节

### Monaco Editor 主题
- **实现**: 自定义主题配置
- **主题**: VS Code Dark/Light, Monokai, Solarized, GitHub
- **特性**:
  - 主题持久化
  - 主题热切换
  - 主题预览
  - 自定义主题

### 代码格式化
- **库**: Prettier
- **支持语言**: JavaScript, TypeScript, JSON, HTML, CSS, Markdown
- **特性**:
  - 快捷键触发
  - 自动格式化
  - 格式化配置
  - 错误处理

### 代码搜索
- **实现**: Monaco Editor 搜索 API
- **特性**:
  - 全局搜索
  - 文件内搜索
  - 正则表达式
  - 搜索结果高亮

### 代码跳转
- **实现**: Monaco Editor 语言服务
- **特性**:
  - 定义跳转
  - 引用查找
  - 符号导航
  - 跳转历史

### 代码对比
- **实现**: Monaco Diff Editor
- **特性**:
  - Inline Diff
  - Side-by-Side Diff
  - Diff 导航
  - Git Diff 集成

---

## 📈 性能指标

### 优化前 vs 优化后

| 指标 | 优化前 | 优化后（预期） | 提升 |
|------|--------|----------------|------|
| 主题切换时间 | ~500ms | < 100ms | 80%+ |
| 格式化时间 | ~1s | < 200ms | 80%+ |
| 搜索响应时间 | ~500ms | < 100ms | 80%+ |
| 跳转响应时间 | ~300ms | < 50ms | 83%+ |
| Diff 渲染时间 | ~1s | < 200ms | 80%+ |
| 片段触发时间 | ~100ms | < 20ms | 80%+ |

---

## 🧪 测试建议

### 功能测试
1. 测试主题切换功能
2. 测试代码格式化功能
3. 测试代码搜索功能
4. 测试代码跳转功能
5. 测试代码对比功能
6. 测试代码片段功能
7. 测试快捷键功能

### 性能测试
1. 测试主题切换性能
2. 测试格式化性能
3. 测试搜索性能
4. 测试跳转性能
5. 测试 Diff 渲染性能

### 兼容性测试
1. Chrome 浏览器测试
2. Firefox 浏览器测试
3. Safari 浏览器测试
4. Edge 浏览器测试
5. 移动端测试

---

## 📝 下一步行动

### Phase 8: 测试和文档（建议）
- [ ] 单元测试
- [ ] 集成测试
- [ ] E2E 测试
- [ ] 用户文档
- [ ] API 文档

### 最终交付
- [ ] 性能优化验证
- [ ] 功能完整性验证
- [ ] 用户验收测试
- [ ] 生产环境部署

---

**任务创建时间**: 2026-01-18
**预计完成时间**: 2-3 天
**优先级**: P0